(window.webpackJsonp=window.webpackJsonp||[]).push([[174],{681:function(a,s,t){"use strict";t.r(s);var e=t(2),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"centos7-升级-更新内核"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#centos7-升级-更新内核"}},[a._v("#")]),a._v(" CentOs7 升级/更新内核")]),a._v(" "),s("h2",{attrs:{id:"内核定义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内核定义"}},[a._v("#")]),a._v(" 内核定义")]),a._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[a._v("See More")]),a._v(" "),s("p",[a._v("关于内核版本的定义：")]),a._v(" "),s("p",[a._v("版本性质：主分支ml(mainline)，稳定版(stable)，长期维护版lt(longterm)")]),a._v(" "),s("p",[a._v("版本命名格式为 “A.B.C”：")]),a._v(" "),s("p",[a._v("数字 A 是内核版本号：版本号只有在代码和内核的概念有重大改变的时候才会改变，历史上有两次变化：\n数字 B 是内核主版本号：主版本号根据传统的奇-偶系统版本编号来分配：奇数为开发版，偶数为稳定版\n数字 C 是内核次版本号：次版本号是无论在内核增加安全补丁、修复bug、实现新的特性或者驱动时都会改变")])]),a._v(" "),s("h2",{attrs:{id:"升级内核"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级内核"}},[a._v("#")]),a._v(" 升级内核")]),a._v(" "),s("p",[a._v("1、查看当前内核")]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[a._v("uname "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("r\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 3.10.0-514.el7.x86_64")]),a._v("\n")])])]),s("p",[a._v("2、升级内核")]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 升级内核需要先导入elrepo的key，然后安装elrepo的yum源：")]),a._v("\nrpm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("import https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//www.elrepo.org/RPM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("GPG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("KEY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("elrepo.org\nyum install "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("y https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//www.elrepo.org/elrepo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("release"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("7.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("4.el7.elrepo.noarch.rpm\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果要安装ml内核，使用如下命令：")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("enablerepo=elrepo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("kernel "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("y install kernel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("ml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("devel kernel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("ml\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果要安装lt内核，使用如下命令：")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("enablerepo=elrepo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("kernel "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("y install kernel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("lt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("devel kernel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("lt\n")])])]),s("p",[a._v("3、设置默认内核")]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[a._v("grub2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("default 0\ngrub2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("mkconfig "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("o /boot/grub2/grub.cfg \n")])])]),s("p",[a._v("4、删除旧的内核")]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看已安装的内核")]),a._v("\nrpm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("qa "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" grep kernel\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除旧内核")]),a._v("\nyum remove 内核名称\n")])])]),s("p",[a._v("5、安装新版本工具包（可选操作）")]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 移除旧版本")]),a._v("\nyum remove kernel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("tools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("libs kernel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("tools "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("y\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装新版本")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果安装ml版本执行：")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("disablerepo=* "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("enablerepo=elrepo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("kernel install kernel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("ml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("tools\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果安装lt版本执行：")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("disablerepo=* "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("enablerepo=elrepo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("kernel install kernel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("lt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("tools\n")])])]),s("p",[a._v("6、重启服务器，执行 "),s("code",[a._v("reboot")])]),a._v(" "),s("p",[a._v("7、查看内核")]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[a._v("uname "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("r\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 5.3.8-1.el7.elrepo.x86_64 显示新版内核即表示升级成功")]),a._v("\n")])])]),s("h2",{attrs:{id:"一键升级内核脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一键升级内核脚本"}},[a._v("#")]),a._v(" 一键升级内核脚本")]),a._v(" "),s("blockquote",[s("p",[a._v("vim updateCore.sh"),s("br"),a._v("\n复制以下脚本内容到脚本文件中")])]),a._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[a._v("See More")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("red")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'\\033[0;31m'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("green")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'\\033[0;32m'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("yellow")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'\\033[0;33m'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("plain")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'\\033[0m'")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$EUID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ne")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"['),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${red}")]),a._v("Error"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${plain}")]),a._v('] This script must be run as root!"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("k")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${red}")]),a._v("当前内核版本 "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${green}")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$k")]),a._v('"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${red}")]),a._v("升级linux内核"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${green}")]),a._v('"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rpm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--import")]),a._v(" https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" https://www.elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpm\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${red}")]),a._v("安装ml内核"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${green}")]),a._v('"')]),a._v("\n\nyum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--enablerepo")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("elrepo-kernel "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" kernel-ml-devel kernel-ml\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${red}")]),a._v("设置为默认内核"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${green}")]),a._v('"')]),a._v("\n\ngrub2-set-default "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\ngrub2-mkconfig "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" /boot/grub2/grub.cfg \n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${red}")]),a._v("查看已安装的内核"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${green}")]),a._v('"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rpm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-qa")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" kernel\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${red}")]),a._v("移除旧版本内核"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${green}")]),a._v('"')]),a._v("\n\nyum remove k\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${red}")]),a._v("移除旧版本工具包"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${green}")]),a._v('"')]),a._v("\n\nyum remove kernel-tools-libs kernel-tools "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${red}")]),a._v("安装新版本工具包"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${green}")]),a._v('"')]),a._v("\n\nyum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--disablerepo")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("* "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--enablerepo")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("elrepo-kernel "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" kernel-ml-tools\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${green}")]),a._v("升级完成，清重启机器（reboot）"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${green}")]),a._v('"')]),a._v("\n")])])])]),a._v(" "),s("blockquote",[s("p",[a._v("chmod +x updateCore.sh && ./updateCore.sh")])])])}),[],!1,null,null,null);s.default=n.exports}}]);